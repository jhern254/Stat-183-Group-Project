---
title: "GroupProject"
author: "Jun Hernandez, Victoria Rios, "
date: "May 6, 2020"
output: pdf_document
---

```{r}
#install.packages("read_xl")
#install.packages("tidyverse") # uncomment to install tidyverse and make sure you are on up to date version
#install.packages("rcompanion")
#install.packages("DescTools")
```

```{r}
library(tidyverse)
library(readxl)
library(rcompanion)
```

```{r}
# read in xlsx data set
df <- read_excel("/Users/junhernandez/Documents/A\ -\ Current\ Quarter/Stat\ 183/Group\ Project/all\ responses\ data\ team\ 1.xlsx") # change for your computer

#View(df)

head(df)
# test
```

#7 using # 23 data(gender - m/f)

```{r}
# get rid of first row
df_fixed <- df[-c(1), ]
# subset dataset for #7
jun_df <- df_fixed %>%
  select(	
   culture = `UCR has a culture and environment that promotes and supports health and well-being for its faculty, staff and students.`,
   gender =`What is your gender?`) %>%
  filter(!(is.na(gender))) %>%
  filter(gender == 'Male'| gender == 'Female') %>%   # only focused on male and female data
  filter(!(is.na(culture)))   # 16 NAs filtered in culture

# set vars as factor
jun_df$culture <- as.factor(jun_df$culture)
jun_df$gender <- as.factor(jun_df$gender)
  
jun_df

#unique(jun_df$gender)
#unique(jun_df$culture)
```


```{r}
# based on count
jun_df %>% ggplot(mapping = aes(x = culture)) +
  geom_bar(aes(fill = culture)) +
  labs(x = "Survey Response", 
       y = "Number of responses", 
       title = "UCR has a culture and environment that promotes and supports health 
       and well-being for its faculty, staff and students") +
  theme(legend.position="none")
# add sub title for No. of participants

# based on count
jun_df %>% ggplot(mapping = aes(x = culture)) +
  geom_bar(aes(fill = gender)) +
  labs(x = "Survey Response", 
       y = "Number of responses", 
       title = "UCR has a culture and environment that promotes and supports health 
       and well-being for its faculty, staff and students") 
```

```{r}
# based on proportion
jun_df %>% filter(gender == 'Female') %>%
   ggplot(mapping = aes(x = culture, 
                        y = prop.table(stat(count)),
                        fill = culture,
                        label = scales::percent(prop.table(stat(count))))) +
   geom_bar(position = "dodge") + 
   geom_text(stat = 'count',
              position = position_dodge(.9), 
              vjust = -0.5, 
              size = 3) + 
   scale_y_continuous(labels = scales::percent) +
   labs(x = "Survey Response", 
       y = "Proportion of responses", 
       title = "Female") +
   theme(legend.position="none")
```

```{r}
# based on proportion
jun_df %>% filter(gender == 'Male') %>%
   ggplot(mapping = aes(x = culture, 
                        y = prop.table(stat(count)),
                        fill = culture,
                        label = scales::percent(prop.table(stat(count))))) +
   geom_bar(position = "dodge") + 
   geom_text(stat = 'count',
              position = position_dodge(.9), 
              vjust = -0.5, 
              size = 3) + 
   scale_y_continuous(labels = scales::percent) +
   labs(x = "Survey Response", 
       y = "Proportion of responses", 
       title = "Male") +
   theme(legend.position="none")

```



**Chi-squared test**

```{r}
#str(jun_df)
res <- chisq.test(jun_df$gender, jun_df$culture)
# Access to the GoF values
res$expected
res$observed
res$stdres
# output
res
```


```{r}
tbl <- table(jun_df$culture, jun_df$gender)
chisq.test(tbl)

pairwiseNominalIndependence(tbl,
                            fisher = FALSE,
                            gtest  = FALSE,
                            chisq  = TRUE,
                            method = "bonferroni")
```



**ggplot proportion gender plot**
This works well enough, will try to turn into function. Also, remember to make a temporary dataset for whatever question you are doing. Do not edit the main dataset so there will be no compatibility problems.
```{r}
# based on proportion
jun_df %>% filter(gender == 'Female') %>%   # enter your data set into function, based on gender
   ggplot(mapping = aes(x = culture,        # change x for your problem
                        y = prop.table(stat(count)),
                        fill = culture,
                        label = scales::percent(prop.table(stat(count))))) +
   geom_bar(position = "dodge") + 
   geom_text(stat = 'count',
              position = position_dodge(.9), 
              vjust = -0.5, 
              size = 3) + 
   scale_y_continuous(labels = scales::percent) +   
   labs(x = "Survey Response", 
       y = "Proportion of responses", 
       title = "Female") +    # Change labels based on your question
   theme(legend.position="none")
```


#5 using data from column 22  
In which of the following categories do you place yourself?  

```{r q5 data subset}
# get rid of first row
# commenting this out for now
df_fixed <- df[-c(1), ]

# subset dataset for #5
victoria_df <- df_fixed %>%
  select(	
   lifestyle = `In which of the following categories do you place yourself?`,
   gender =`What is your gender?`) %>%
  filter(!(is.na(gender))) %>% #removing responses without gender
  filter(gender == 'Male'| gender == 'Female') %>%   # removing 29 'other'
  filter(!(is.na(lifestyle)))   # 14 NAs filtered in lifestyle (people who didn't respond)

# set vars as factor
victoria_df$lifestyle <- as.factor(victoria_df$lifestyle)
victoria_df$gender <- as.factor(victoria_df$gender)
  
glimpse(victoria_df)
```

```{r q5 overview}
# based on count
victoria_df %>%
ggplot(mapping = aes(x = lifestyle,
label = stat(count))) +
geom_bar(aes(fill = lifestyle)) +
labs(x = "Survey Response (N = 1311)", # maybe change with a formula
y = "Number of responses",
title = "In which of the following categories do you place yourself?") +
theme(legend.position="none",
axis.text.x = element_text( hjust=0.5)) + # center align the axis labels
geom_text(stat = 'count',
position = position_dodge(.9),
vjust = -0.5,
size = 3) +
# my variable names are really long
scale_x_discrete(
labels = c("I am not interested \nin pursuing a \nhealthier lifestyle",
"I am thinking about \nchanging some of my \nhealth behaviors",
"I am planning on \nmaking a health \nbehavior change within \nthe next 30 days",
"I have made some \nhealth behavior \nchanges within \nthe last 6 months",
"I have been living \na healthy lifestyle \nfor at least 6 months"))
```

```{r option1: facet wrap}
# based on proportion
victoria_df %>%
#  filter(gender == 'Female') %>%
ggplot(mapping = aes(x = lifestyle,
y = prop.table(stat(count)),
fill = lifestyle,
label = scales::percent(prop.table(stat(count))))) +
geom_bar(position = "dodge") +
facet_wrap(~gender, nrow = 1) +
geom_text(stat = 'count',
position = position_dodge(.9),
vjust = -0.5,
size = 3) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Survey Response",
y = "Proportion of responses",
title = "Response by Gender") +
theme(legend.position="right",
legend.title = element_blank(),
legend.text = element_text(lineheight = .8),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()) +
scale_fill_discrete(
labels = c("I am not interested \nin pursuing a \nhealthier lifestyle",
"I am thinking about \nchanging some of my \nhealth behaviors",
"I am planning on \nmaking a health \nbehavior change within \nthe next 30 days",
"I have made some \nhealth behavior \nchanges within \nthe last 6 months",
"I have been living \na healthy lifestyle \nfor at least 6 months"))
```

```{r option2}
# based on proportion
victoria_df %>%
#  filter(gender == 'Male') %>%
ggplot(mapping = aes(x = lifestyle,
y = prop.table(stat(count)),
fill = gender,
label = scales::percent(prop.table(stat(count))))) +
geom_bar(position = "dodge") +
geom_text(stat = 'count',
position = position_dodge(.9),
vjust = -0.5,
size = 3) +
scale_y_continuous(labels = scales::percent) +
labs(x = "Survey Response",
y = "Proportion of responses",
title = "Response by Gender") +
theme(legend.position="none",
axis.text.x = element_text( hjust=0.5)) + # center align the axis text)
# my variable names are really long
scale_x_discrete(
labels = c("I am not interested \nin pursuing a \nhealthier lifestyle",
"I am thinking about \nchanging some of my \nhealth behaviors",
"I am planning on \nmaking a health \nbehavior change within \nthe next 30 days",
"I have made some \nhealth behavior \nchanges within \nthe last 6 months",
"I have been living \na healthy lifestyle \nfor at least 6 months"))
```

```{r chisquared test}
victoria_res <- chisq.test(victoria_df$gender, victoria_df$lifestyle)
# Access to the GoF values
victoria_res$expected
victoria_res$observed
victoria_res$stdres
# output
victoria_res

victoria_tbl <- table(victoria_df$gender, victoria_df$lifestyle)
victoria_tbl

chisq.test(victoria_tbl)

pairwiseNominalIndependence(victoria_tbl,
                            fisher = FALSE,
                            gtest  = FALSE,
                            chisq  = TRUE,
                            method = "bonferroni")

```

Frequency distributions are significantly different between males and females (chi-square test p-value = .0013). More women (24%) than men(9%) state that they have been living a healthy lifestyle for at least 6 months.  

